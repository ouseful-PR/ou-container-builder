#
# Dockerfile generated by: ou-container-builder
#
# OpenRefine standalaone app container
#
# Module: OpenRefine
# Presentation: 21J
#
# Description: For use originally in TM351
#


FROM python:3.9-slim-buster



ARG USER="jovyan"



ENV USER=${USER}
ENV UID="1000"
ENV GID="100"
ENV MODULE_CODE="OpenRefine"
ENV MODULE_PRESENTATION="21J"
ENV HOME="/home/$USER/$MODULE_CODE-$MODULE_PRESENTATION"

# Just in case something needs it, conform to Jupyter convention
ENV NB_USER=${USER}


USER root


RUN mkdir /home/$USER && \
    useradd -u $UID -g $GID -d $HOME -m $USER


RUN apt-get update -y && \
    apt-get install -y tini


  
RUN mkdir -p /usr/share/man/man1
  



  



  
# Apt package installation
RUN apt install -y \
  wget \ 
  openjdk-11-jdk \
  && apt-get clean && rm -rf /var/lib/apt/lists/*
  





  

RUN pip install --no-cache jupyter-server-proxy jupyterhub==1.3.0







  
    
      
RUN wget --no-check-certificate https://github.com/OpenRefine/OpenRefine/releases/download/3.3/openrefine-linux-3.3.tar.gz && \
    mkdir /var/openrefine && \
    tar -xzf openrefine-linux-3.3.tar.gz --directory /var/openrefine && \
    rm openrefine-linux-3.3.tar.gz
      
    
  




COPY ou-builder-build/start-web-app.sh /usr/bin/start.sh
RUN chmod a+x /usr/bin/start.sh
COPY ou-builder-build/jupyter_server_config.py /etc/jupyter/jupyter_server_config.py




# Check permissions
RUN chown -R $USER:$GID $HOME


# Reset user
USER $USER



# Reset home
WORKDIR $HOME

# Initialise container
ENTRYPOINT ["tini", "-g", "--"]



CMD ["start.sh"]
